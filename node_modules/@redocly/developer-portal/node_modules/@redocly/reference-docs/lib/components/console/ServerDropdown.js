"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),React=tslib_1.__importStar(require("react")),redoc_lib_1=require("../../redoc-lib"),mobx_react_1=require("mobx-react"),utils_1=require("../../utils"),ServerVariable_1=tslib_1.__importDefault(require("./ServerVariable")),form_1=require("../common/form"),ServerDropdownWrap=redoc_lib_1.styled.div(templateObject_1||(templateObject_1=tslib_1.__makeTemplateObject(["\n  margin-top: 20px;\n"],["\n  margin-top: 20px;\n"]))),ServerChooser=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(r,"state",{enumerable:!0,configurable:!0,writable:!0,value:{activeIdx:0,variables:{}}}),Object.defineProperty(r,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:function(e){var a=r.props.operation.servers.find((function(r){return r.url===e.serverUrl})),t=a&&getVariables(a)||{};r.props.onChange({url:e.serverUrl,variables:t}),utils_1.toStorage("serverUrl",e.serverUrl),r.setState({variables:t})}}),Object.defineProperty(r,"handleVariableChange",{enumerable:!0,configurable:!0,writable:!0,value:function(e,a){var t,i,n=tslib_1.__assign(tslib_1.__assign({},r.state.variables),((t={})[e]=a,t));r.setState({variables:n});var l=utils_1.fromStorage("variables"),s=l&&JSON.parse(l)||{};utils_1.toStorage("variables",JSON.stringify(tslib_1.__assign(tslib_1.__assign({},s),((i={})[e]=a,i))));var o=r.props.operation.servers[r.state.activeIdx];r.props.onChange(tslib_1.__assign(tslib_1.__assign({},o),{variables:n}))}}),r}return tslib_1.__extends(r,e),Object.defineProperty(r,"getDerivedStateFromProps",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var r=e.operation,a=utils_1.fromStorage("serverUrl"),t=r.servers.findIndex((function(e){return e.url===a}));return{activeIdx:t<0?0:t}}}),Object.defineProperty(r.prototype,"componentDidMount",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.props.operation.servers[this.state.activeIdx],r=getVariables(e);this.props.onChange(tslib_1.__assign(tslib_1.__assign({},e),{variables:r})),this.setState({variables:r})}}),Object.defineProperty(r.prototype,"render",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this,r=this.state.activeIdx,a=this.props.operation.servers.map((function(r){return{serverUrl:r.url,value:"\n          "+expandDefaultServerVariables(expandVariables(r.url,e.state.variables),r.variables)+"\n        - "+(r.description||"Default")+"\n      "}})),t=Object.keys(this.state.variables);return React.createElement(ServerDropdownWrap,null,React.createElement(form_1.FormLabel,{htmlFor:"server"},"Target server: "),React.createElement(form_1.FormControl,null,React.createElement(redoc_lib_1.Dropdown,{openUp:!0,variant:"dark",value:a[r].value,options:a,onChange:this.handleChange})),t.length?t.map((function(r){var a=e.props.operation.servers[e.state.activeIdx].variables[r];return React.createElement(ServerVariable_1.default,{key:r,name:r,value:e.state.variables[r],defaultValue:a.default,onChange:function(a){return e.handleVariableChange(r,a)},variableEnum:a.enum,description:a.description})})):null)}}),r=tslib_1.__decorate([mobx_react_1.observer],r)}(React.Component);exports.ServerChooser=ServerChooser;var templateObject_1,pathTemplateRegExp=/(?:{)(\w+)(?:})/g;function expandVariables(e,r){return void 0===r&&(r={}),e.replace(pathTemplateRegExp,(function(e,a){return r[a]||e}))}function expandDefaultServerVariables(e,r){return void 0===r&&(r={}),e.replace(pathTemplateRegExp,(function(e,a){return r[a]&&r[a].default||e}))}function getVariables(e){if(!e.variables)return{};var r=utils_1.fromStorage("variables"),a=r&&JSON.parse(r)||{},t={};return Object.keys(e.variables).forEach((function(r){t[r]=e.variables[r].default||"",a.hasOwnProperty(r)&&(t[r]=a[r])})),tslib_1.__assign({},t)}exports.expandVariables=expandVariables;
//# sourceMappingURL=ServerDropdown.js.map