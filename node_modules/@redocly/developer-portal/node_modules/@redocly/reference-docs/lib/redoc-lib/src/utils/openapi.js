"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),path_1=require("path"),url_template_1=tslib_1.__importDefault(require("url-template")),dom_1=require("./dom"),helpers_1=require("./helpers");function isWildcardStatusCode(e){return"string"==typeof e&&/\dxx/i.test(e)}function isStatusCode(e){return"default"===e||helpers_1.isNumeric(e)||isWildcardStatusCode(e)}function getStatusCodeType(e,r){if(void 0===r&&(r=!1),"default"===e)return r?"error":"success";var i="string"==typeof e?parseInt(e,10):e;if(isWildcardStatusCode(e)&&(i*=100),i<100||i>599)throw new Error("invalid HTTP code");var t="success";return i>=300&&i<400?t="redirect":i>=400?t="error":i<200&&(t="info"),t}exports.isStatusCode=isStatusCode,exports.getStatusCodeType=getStatusCodeType;var operationNames={get:!0,post:!0,put:!0,head:!0,patch:!0,delete:!0,options:!0,$ref:!0};function isOperationName(e){return e in operationNames}function getOperationSummary(e){return e.summary||e.operationId||e.description&&e.description.substring(0,50)||"<no summary>"}exports.isOperationName=isOperationName,exports.getOperationSummary=getOperationSummary;var schemaKeywordTypes={multipleOf:"number",maximum:"number",exclusiveMaximum:"number",minimum:"number",exclusiveMinimum:"number",maxLength:"string",minLength:"string",pattern:"string",contentEncoding:"string",contentMediaType:"string",items:"array",maxItems:"array",minItems:"array",uniqueItems:"array",maxProperties:"object",minProperties:"object",required:"object",additionalProperties:"object",properties:"object"};function detectType(e){if(void 0!==e.type&&!Array.isArray(e.type))return e.type;for(var r=0,i=Object.keys(schemaKeywordTypes);r<i.length;r++){var t=i[r],n=schemaKeywordTypes[t];if(void 0!==e[t])return n}return"any"}function isPrimitiveType(e,r){if(void 0===r&&(r=e.type),void 0!==e.oneOf||void 0!==e.anyOf)return!1;var i=!0,t=Array.isArray(r);return("object"===r||t&&(null==r?void 0:r.includes("object")))&&(i=void 0!==e.properties?0===Object.keys(e.properties).length:void 0===e.additionalProperties),void 0!==e.items&&("array"===r||t&&(null==r?void 0:r.includes("array")))&&(i=isPrimitiveType(e.items,e.items.type)),i}function isJsonLike(e){return-1!==e.search(/json/i)}function isFormUrlEncoded(e){return"application/x-www-form-urlencoded"===e}function delimitedEncodeField(e,r,i){return Array.isArray(e)?e.map((function(e){return e.toString()})).join(i):"object"==typeof e?Object.keys(e).map((function(r){return""+r+i+e[r]})).join(i):r+"="+e.toString()}function deepObjectEncodeField(e,r){return Array.isArray(e)?(console.warn("deepObject style cannot be used with array value:"+e.toString()),""):"object"==typeof e?Object.keys(e).map((function(i){return e[i]?r+"["+i+"]="+e[i]:void 0})).filter(Boolean).join("&"):(console.warn("deepObject style cannot be used with non-object value:"+e.toString()),"")}function serializeFormValue(e,r,i){var t,n="__redoc_param_name__",a=r?"*":"";return url_template_1.default.parse("{?"+n+a+"}").expand((t={},t[n]=i,t)).substring(1).replace(/__redoc_param_name__/g,e)}function urlFormEncodePayload(e,r){if(void 0===r&&(r={}),Array.isArray(e))throw new Error("Payload must have fields: "+e.toString());return Object.keys(e).map((function(i){var t=e[i],n=r[i]||{},a=n.style,o=void 0===a?"form":a,s=n.explode,u=void 0===s||s;switch(o){case"form":return serializeFormValue(i,u,t);case"spaceDelimited":return delimitedEncodeField(t,i,"%20");case"pipeDelimited":return delimitedEncodeField(t,i,"|");case"deepObject":return deepObjectEncodeField(t,i);default:return console.warn("Incorrect or unsupported encoding style: "+o),""}})).join("&")}function serializePathParameter(e,r,i,t){var n,a=i?"*":"",o="";"label"===r?o=".":"matrix"===r&&(o=";");var s="__redoc_param_name__";return url_template_1.default.parse("{"+o+s+a+"}").expand((n={},n[s]=t,n)).replace(/__redoc_param_name__/g,e)}function serializeQueryParameter(e,r,i,t){switch(r){case"form":return serializeFormValue(e,i,t);case"spaceDelimited":return Array.isArray(t)?i?serializeFormValue(e,i,t):e+"="+t.join("%20"):(console.warn("The style spaceDelimited is only applicable to arrays"),"");case"pipeDelimited":return Array.isArray(t)?i?serializeFormValue(e,i,t):e+"="+t.join("|"):(console.warn("The style pipeDelimited is only applicable to arrays"),"");case"deepObject":return!i||Array.isArray(t)||"object"!=typeof t?(console.warn("The style deepObject is only applicable for objects with explode=true"),""):deepObjectEncodeField(t,e);default:return console.warn("Unexpected style for query: "+r),""}}function serializeHeaderParameter(e,r,i){var t;switch(e){case"simple":var n=r?"*":"",a="__redoc_param_name__",o=url_template_1.default.parse("{"+a+n+"}");return decodeURIComponent(o.expand(((t={})[a]=i,t)));default:return console.warn("Unexpected style for header: "+e),""}}function serializeCookieParameter(e,r,i,t){switch(r){case"form":return serializeFormValue(e,i,t);default:return console.warn("Unexpected style for cookie: "+r),""}}function serializeParameterValueWithMime(e,r){return isJsonLike(r)?JSON.stringify(e):(console.warn("Parameter serialization as "+r+" is not supported"),"")}function serializeParameterValue(e,r){var i=e.name,t=e.style,n=e.explode,a=void 0!==n&&n,o=e.serializationMime;if(o)switch(e.in){case"path":case"header":return serializeParameterValueWithMime(r,o);case"cookie":case"query":return i+"="+serializeParameterValueWithMime(r,o);default:return console.warn("Unexpected parameter location: "+e.in),""}if(!t)return console.warn("Missing style attribute or content for parameter "+i),"";switch(e.in){case"path":return serializePathParameter(i,t,a,r);case"query":return serializeQueryParameter(i,t,a,r);case"header":return serializeHeaderParameter(t,a,r);case"cookie":return serializeCookieParameter(i,t,a,r);default:return console.warn("Unexpected parameter location: "+e.in),""}}function langFromMime(e){return-1!==e.search(/xml/i)?"xml":"clike"}function isNamedDefinition(e){return/^#\/components\/(schemas|pathItems)\/[^\/]+$/.test(e||"")}function getDefinitionName(e){if(e){var r=e.match(/^#\/components\/(schemas|pathItems)\/([^\/]+)$/);return null===r?void 0:r[1]}}function humanizeMultipleOfConstraint(e){if(void 0!==e){var r=e.toString(10);return/^0\.0*1$/.test(r)?"decimal places <= "+r.split(".")[1].length:"multiple of "+r}}function humanizeRangeConstraint(e,r,i){var t;return void 0!==r&&void 0!==i?t=r===i?r+" "+e:"[ "+r+" .. "+i+" ] "+e:void 0!==i?t="<= "+i+" "+e:void 0!==r&&(t=1===r?"non-empty":">= "+r+" "+e),t}function humanizeConstraints(e){var r=[],i=humanizeRangeConstraint("characters",e.minLength,e.maxLength);void 0!==i&&r.push(i);var t=humanizeRangeConstraint("items",e.minItems,e.maxItems);void 0!==t&&r.push(t);var n,a=humanizeMultipleOfConstraint(e.multipleOf);if(void 0!==a&&r.push(a),void 0!==e.minimum&&void 0!==e.maximum?(n=e.exclusiveMinimum?"( ":"[ ",n+=e.minimum,n+=" .. ",n+=e.maximum,n+=e.exclusiveMaximum?" )":" ]"):void 0!==e.maximum?(n=e.exclusiveMaximum?"< ":"<= ",n+=e.maximum):void 0!==e.minimum&&(n=e.exclusiveMinimum?"> ":">= ",n+=e.minimum),"number"==typeof e.exclusiveMinimum||"number"==typeof e.exclusiveMaximum){var o=0,s=0;e.minimum&&(o=e.minimum),"number"==typeof e.exclusiveMinimum&&(o=o<=e.exclusiveMinimum?o:e.exclusiveMinimum),e.maximum&&(s=e.maximum),"number"==typeof e.exclusiveMaximum&&(s=s>e.exclusiveMaximum?s:e.exclusiveMaximum),n="["+o+" .. "+s+"]"}return void 0!==n&&r.push(n),e.uniqueItems&&r.push("unique"),r}function sortByRequired(e,r){void 0===r&&(r=[]);var i=[],t=[],n=[];return e.forEach((function(e){e.required?r.includes(e.name)?t.push(e):n.push(e):i.push(e)})),t.sort((function(e,i){return r.indexOf(e.name)-r.indexOf(i.name)})),tslib_1.__spreadArrays(t,n,i)}function sortByField(e,r){return tslib_1.__spreadArrays(e).sort((function(e,i){return e[r].localeCompare(i[r])}))}function mergeParams(e,r,i){void 0===r&&(r=[]),void 0===i&&(i=[]);var t={};return i.forEach((function(r){r=e.shallowDeref(r),t[r.name+"_"+r.in]=!0})),(r=r.filter((function(r){return r=e.shallowDeref(r),!t[r.name+"_"+r.in]}))).concat(i)}function mergeSimilarMediaTypes(e){var r={};return Object.keys(e).forEach((function(i){var t=e[i],n=i.split(";")[0].trim();r[n]?r[n]=tslib_1.__assign(tslib_1.__assign({},r[n]),t):r[n]=t})),r}function expandDefaultServerVariables(e,r){return void 0===r&&(r={}),e.replace(/(?:{)([\w-.]+)(?:})/g,(function(e,i){return r[i]&&r[i].default||e}))}function normalizeServers(e,r){var i=void 0===e?helpers_1.removeQueryString(function(){if(!dom_1.IS_BROWSER)return"";var e=window.location.href;return e.endsWith(".html")?path_1.dirname(e):e}()):path_1.dirname(e);return 0===r.length&&(r=[{url:"/"}]),r.map((function(e){return tslib_1.__assign(tslib_1.__assign({},e),{url:(r=e.url,helpers_1.resolveUrl(i,r)),description:e.description||""});var r}))}function setSecuritySchemePrefix(e){exports.SECURITY_SCHEMES_SECTION_PREFIX=e}function isRedocExtension(e){return e in{"x-circular-ref":!0,"x-code-samples":!0,"x-codeSamples":!0,"x-displayName":!0,"x-examples":!0,"x-ignoredHeaderParameters":!0,"x-logo":!0,"x-nullable":!0,"x-servers":!0,"x-tagGroups":!0,"x-traitTag":!0,"x-additionalPropertiesName":!0,"x-explicitMappingOnly":!0,"x-enumDescriptions":!0}}function extractExtensions(e,r){return Object.keys(e).filter((function(e){return!0===r?e.startsWith("x-")&&!isRedocExtension(e):e.startsWith("x-")&&r.indexOf(e)>-1})).reduce((function(r,i){return r[i]=e[i],r}),{})}function pluralizeType(e){return e.split(" or ").map((function(e){return e.replace(/^(string|object|number|integer|array|boolean)s?( ?.*)/,"$1s$2")})).join(" or ")}function getContentWithLegacyExamples(e){var r=e.content,i=e["x-examples"],t=e["x-example"];if(i){r=tslib_1.__assign({},r);for(var n=0,a=Object.keys(i);n<a.length;n++){var o=i[m=a[n]];r[m]=tslib_1.__assign(tslib_1.__assign({},r[m]),{examples:o})}}else if(t){r=tslib_1.__assign({},r);for(var s=0,u=Object.keys(t);s<u.length;s++){var m,l=t[m=u[s]];r[m]=tslib_1.__assign(tslib_1.__assign({},r[m]),{example:l})}}return r}exports.detectType=detectType,exports.isPrimitiveType=isPrimitiveType,exports.isJsonLike=isJsonLike,exports.isFormUrlEncoded=isFormUrlEncoded,exports.urlFormEncodePayload=urlFormEncodePayload,exports.serializeQueryParameter=serializeQueryParameter,exports.serializeParameterValueWithMime=serializeParameterValueWithMime,exports.serializeParameterValue=serializeParameterValue,exports.langFromMime=langFromMime,exports.isNamedDefinition=isNamedDefinition,exports.getDefinitionName=getDefinitionName,exports.humanizeConstraints=humanizeConstraints,exports.sortByRequired=sortByRequired,exports.sortByField=sortByField,exports.mergeParams=mergeParams,exports.mergeSimilarMediaTypes=mergeSimilarMediaTypes,exports.expandDefaultServerVariables=expandDefaultServerVariables,exports.normalizeServers=normalizeServers,exports.SECURITY_DEFINITIONS_COMPONENT_NAME="security-definitions",exports.SECURITY_DEFINITIONS_JSX_NAME="SecurityDefinitions",exports.SCHEMA_DEFINITION_JSX_NAME="SchemaDefinition",exports.SECURITY_SCHEMES_SECTION_PREFIX="section/Authentication/",exports.setSecuritySchemePrefix=setSecuritySchemePrefix,exports.shortenHTTPVerb=function(e){return{delete:"del",options:"opts"}[e]||e},exports.isRedocExtension=isRedocExtension,exports.extractExtensions=extractExtensions,exports.pluralizeType=pluralizeType,exports.getContentWithLegacyExamples=getContentWithLegacyExamples;
//# sourceMappingURL=openapi.js.map