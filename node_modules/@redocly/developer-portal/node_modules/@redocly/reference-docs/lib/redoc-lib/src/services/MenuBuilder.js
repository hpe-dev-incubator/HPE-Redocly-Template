"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),utils_1=require("../utils"),MarkdownRenderer_1=require("./MarkdownRenderer"),models_1=require("./models");exports.GROUP_DEPTH=0;var MenuBuilder=function(){function e(){}return Object.defineProperty(e,"buildStructure",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t){var n=r.definition,a=[],i=e.getTagsWithOperations(r);return a.push.apply(a,e.addMarkdownItems(n.info.description||"",void 0,1,t)),n["x-tagGroups"]&&n["x-tagGroups"].length>0?a.push.apply(a,e.getTagGroupsItems(r,void 0,n["x-tagGroups"],i,t)):a.push.apply(a,e.getTagsItems(r,i,void 0,void 0,t)),a}}),Object.defineProperty(e,"addMarkdownItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,t,n){var a=new MarkdownRenderer_1.MarkdownRenderer(n).extractHeadings(e||"");a.length&&r&&r.description&&(r.description=MarkdownRenderer_1.MarkdownRenderer.getTextBeforeHading(r.description,a[0].name));var i=function(e,r,t){return void 0===t&&(t=1),r.map((function(r){var n=new models_1.GroupModel("section",r,e);return n.depth=t,r.items&&(n.items=i(n,r.items,t+1)),MarkdownRenderer_1.MarkdownRenderer.containsComponent(n.description||"",utils_1.SECURITY_DEFINITIONS_COMPONENT_NAME)&&utils_1.setSecuritySchemePrefix(n.id+"/"),n}))};return i(r,a,t)}}),Object.defineProperty(e,"getTagGroupsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t,n,a,i){for(var o=[],s=0,l=n;s<l.length;s++){var p=l[s],u=new models_1.GroupModel("group",p,t);u.depth=exports.GROUP_DEPTH,u.items=e.getTagsItems(r,a,u,p,i),o.push(u)}return o}}),Object.defineProperty(e,"getTagsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(r,t,n,a,i){for(var o=[],s=0,l=(void 0===a?Object.keys(t):a.tags).map((function(e){return t[e]?(t[e].used=!0,t[e]):(console.warn('Non-existing tag "'+e+'" is added to the group "'+a.name+'"'),null)}));s<l.length;s++){var p=l[s];if(p){var u=new models_1.GroupModel("tag",p,n);if(u.depth=exports.GROUP_DEPTH+1,""!==p.name)u.items=tslib_1.__spreadArrays(e.addMarkdownItems(p.description||"",u,u.depth+1,i),this.getOperationsItems(r,u,p,u.depth+1,i)),o.push(u);else{var d=tslib_1.__spreadArrays(e.addMarkdownItems(p.description||"",u,u.depth+1,i),this.getOperationsItems(r,void 0,p,u.depth+1,i));o.push.apply(o,d)}}}return i.sortTagsAlphabetically&&o.sort(utils_1.alphabeticallyByProp("name")),o}}),Object.defineProperty(e,"getOperationsItems",{enumerable:!1,configurable:!0,writable:!0,value:function(e,r,t,n,a){if(0===t.operations.length)return[];for(var i=[],o=0,s=t.operations;o<s.length;o++){var l=s[o],p=new models_1.OperationModel(e,l,r,a);p.depth=n,i.push(p)}return a.sortOperationsAlphabetically&&i.sort(utils_1.alphabeticallyByProp("name")),i}}),Object.defineProperty(e,"getTagsWithOperations",{enumerable:!1,configurable:!0,writable:!0,value:function(e){for(var r={},t=e.definition,n=t["x-webhooks"]||t.webhooks,a=0,i=t.tags||[];a<i.length;a++){var o=i[a];r[o.name]=tslib_1.__assign(tslib_1.__assign({},o),{operations:[]})}function s(e,t,n){for(var a,i=0,o=Object.keys(t||{});i<o.length;i++)for(var l=o[i],p=t[l],u=0,d=Object.keys(p).filter(utils_1.isOperationName);u<d.length;u++){var g=d[u],c=p[g];if(p.$ref){var h=e.deref(p);s(e,((a={})[l]=h,a),n)}else{var b=null==c?void 0:c.tags;b&&b.length||(b=[""]);for(var m=0,f=b;m<f.length;m++){var _=f[m],v=r[_];void 0===v&&(v={name:_,operations:[]},r[_]=v),v["x-traitTag"]||v.operations.push(tslib_1.__assign(tslib_1.__assign({},c),{pathName:l,pointer:utils_1.JsonPointer.compile(["paths",l,g]),httpVerb:g,pathParameters:p.parameters||[],pathServers:p.servers,isWebhook:!!n}))}}}}return t.paths&&s(e,t.paths),n&&s(e,n,!0),r}}),e}();exports.MenuBuilder=MenuBuilder;
//# sourceMappingURL=MenuBuilder.js.map