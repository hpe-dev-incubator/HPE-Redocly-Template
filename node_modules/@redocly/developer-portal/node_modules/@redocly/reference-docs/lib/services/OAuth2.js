"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),qs=tslib_1.__importStar(require("querystring")),DEFAULT_OAUTH2_REDIRECT_PAGE="/oauth2-redirect.html",OAuth2=function(){function e(){}return Object.defineProperty(e,"authorizeImplicit",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=t.authorizationUrl,a=t.clientId,n=t.scopes,i=t.extraParams,s=void 0===i?{}:i,o=t.routingBasePath,c=t.redirectUri,l=t.successCallback,u=t.errorCallback,d=encodeState({date:(new Date).toString()}),h=new URL(r),_="/"===o?"":o,b=""+window.location.origin+_+DEFAULT_OAUTH2_REDIRECT_PAGE;for(var p in h.searchParams.set("client_id",a),h.searchParams.set("redirect_uri",c||b),h.searchParams.set("response_type","token"),h.searchParams.set("state",d),Array.isArray(n)&&h.searchParams.set("scope",n.join(" ")),s)h.searchParams.set(p,s[p]);window.redirectOAuth2={flow:"implicit",data:{authorizationUrl:r,clientId:a,scopes:n},state:d,successCallback:function(t){l(t),e.clearRedirectData("implicit")},errorCallback:function(t){u(t),e.clearRedirectData("implicit")}},window.open(h.toString())}}),Object.defineProperty(e,"authorizeAuthorizationCode",{enumerable:!1,configurable:!0,writable:!0,value:function(t){var r=this,a=t.authorizationUrl,n=t.tokenUrl,i=t.clientId,s=t.clientSecret,o=t.scopes,c=t.extraParams,l=void 0===c?{}:c,u=t.routingBasePath,d=t.redirectUri,h=t.successCallback,_=t.errorCallback,b=new URL(a),p="/"===u?"":u,f=""+window.location.origin+p+DEFAULT_OAUTH2_REDIRECT_PAGE,w=encodeState({date:(new Date).toString()});for(var g in b.searchParams.set("client_id",i),b.searchParams.set("redirect_uri",d||f),b.searchParams.set("response_type","code"),b.searchParams.set("state",w),Array.isArray(o)&&b.searchParams.set("scope",o.join(" ")),l)b.searchParams.set(g,l[g]);window.redirectOAuth2={flow:"authorizationCode",data:{authorizationUrl:a,clientId:i,scopes:o},state:w,successCallback:function(t){var a=t.auth_code;return tslib_1.__awaiter(r,void 0,void 0,(function(){var t;return tslib_1.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,fetch(n,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:qs.stringify(tslib_1.__assign({client_id:i,client_secret:s,code:a,grant_type:"authorization_code",redirect_uri:d||f},l))})];case 1:return[4,handleResponseCallback(r.sent(),h,_)];case 2:return r.sent(),[3,4];case 3:return t=r.sent(),_(t),[3,4];case 4:return e.clearRedirectData("authorizationCode"),[2]}}))}))},errorCallback:function(t){_(t),e.clearRedirectData("authorizationCode")}},window.open(b.toString())}}),Object.defineProperty(e,"clearRedirectData",{enumerable:!1,configurable:!0,writable:!0,value:function(e){window.redirectOAuth2={flow:e,data:{authorizationUrl:"",clientId:"",scopes:[]},state:"",successCallback:function(){},errorCallback:function(){}}}}),Object.defineProperty(e,"authorizeClientCredentials",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.tokenUrl,r=e.clientId,a=e.clientSecret,n=e.scopes,i=void 0===n?[]:n,s=e.extraParams,o=void 0===s?{}:s,c=e.successCallback,l=e.errorCallback;return tslib_1.__awaiter(this,void 0,void 0,(function(){var e;return tslib_1.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:qs.stringify(tslib_1.__assign({client_id:r,client_secret:a,grant_type:"client_credentials",scope:Array.isArray(i)?i.join(" "):void 0},o))})];case 1:return[4,handleResponseCallback(n.sent(),c,l)];case 2:return n.sent(),[3,4];case 3:return e=n.sent(),l(e),[3,4];case 4:return[2]}}))}))}}),e}();function handleResponseCallback(e,t,r){return tslib_1.__awaiter(this,void 0,void 0,(function(){var a,n,i,s,o,c;return tslib_1.__generator(this,(function(l){switch(l.label){case 0:return e.ok?[4,e.json()]:[3,2];case 1:return a=l.sent(),t(a),[3,7];case 2:return n=r,i=Error.bind,(e.headers.get("Content-Type")||"").indexOf("json")>-1?(c=(o=JSON).stringify,[4,e.json()]):[3,4];case 3:return s=c.apply(o,[l.sent()]),[3,6];case 4:return[4,e.text()];case 5:s=l.sent(),l.label=6;case 6:n.apply(void 0,[new(i.apply(Error,[void 0,s]))]),l.label=7;case 7:return[2]}}))}))}function randString(e){void 0===e&&(e=32);for(var t="";t.length<e;)t+=Math.random().toString(32).substring(2);return t.substring(0,e)}function encodeState(e){var t=tslib_1.__assign({randomStr:randString()},e);return btoa(JSON.stringify(t))}exports.OAuth2=OAuth2,exports.oauth2Instance=new OAuth2,exports.randString=randString,exports.encodeState=encodeState;
//# sourceMappingURL=OAuth2.js.map