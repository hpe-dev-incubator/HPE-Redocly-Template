"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("tslib"),code_builder_1=require("../../helpers/code-builder"),__1=require("../.."),constants_1=require("../../helpers/constants"),code_helpers_1=require("../../helpers/code-helpers"),utils_1=require("../../../../utils"),indent=1;function printPathVariablesCodeLines(e,t){var s=e.pathParameters;Object.keys(s).forEach((function(e){var r=s[e]||"YOUR_"+e+"_PARAMETER";t.push(indent,t.var(e,constants_1.VariableType.PATH)+' := "%s";',r)}))}function getUrl(e,t){var s=e.fullUrl,r=void 0===s?"":s,n=e.pathParameters,a=void 0===n?{}:n;return code_helpers_1.parseUrlIntoOperands(r,a).map((function(e){return"variable"===e.type?t.var(e.name,constants_1.VariableType.PATH):'"'+e.value+'"'})).join(" + ")}function hasMimeType(e,t){return void 0===e&&(e={}),utils_1.normalizeMimeType(e.mimeType)===t}var handler=function(e,t,s){var r,n,a,i,o,l=s.target,d=s.client,p=tslib_1.__assign({showBoilerplate:!0,checkErrors:!1,printBody:!0,timeout:-1,indent:"  "},t),u=null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r[0],h=p.checkErrors?"err":"_",c=e.method.toUpperCase(),v=new code_builder_1.CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:constants_1.Lang.GO}),m=function(){p.checkErrors&&v.push(indent,"if err != nil {").push(indent+1,"panic(err)").push(indent,"}")};if(p.showBoilerplate&&(v.push("package main").blank().push("import (").push(indent,'"fmt"'),p.timeout>0&&v.push(indent,'"time"'),u&&v.push(indent,'"encoding/json"'),hasMimeType(e.postData,"multipart/form-data")&&(v.push(indent,'"mime/multipart"'),v.push(indent,'"io"'),v.push(indent,'"os"'),v.push(indent,'"bytes"')),(hasMimeType(e.postData,"application/x-www-form-urlencoded")||hasMimeType(null===(a=null===(n=e.securityOAuth2ExtraCalls)||void 0===n?void 0:n[0])||void 0===a?void 0:a.postData,"application/x-www-form-urlencoded"))&&(v.push(indent,'"net/url"'),v.push(indent,'"strconv"')),((null===(i=e.postData)||void 0===i?void 0:i.text)||u)&&v.push(indent,'"strings"'),v.push(indent,'"net/http"'),p.printBody&&v.push(indent,'"io/ioutil"'),v.push(")").blank().push("func main() {")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){e.allHeaders[t]='"'+e.allHeaders[t]+'"'})),u){var f="oAuth2",y=p.checkErrors?h+" := ":"",b=new __1.HTTPSnippet(u).convert(l,d,tslib_1.__assign(tslib_1.__assign({},p),{variablesPrefix:f,showBoilerplate:!1}));v.push(b).blank().push(indent,"var "+v.var("resBody")+" struct {",f).push(indent+1,"Access_token string").push(indent,"}").push(indent,"%sjson.NewDecoder(%sres.Body).Decode(&%sresBody)",y,f,f).blank(),m(),e.allHeaders.Authorization='"Bearer " + oAuth2resBody.Access_token'}if(printPathVariablesCodeLines(e,v),p.timeout>0&&(d=v.var("client"),v.push(indent,"%s := http.Client{",d).push(indent+1,"Timeout: time.Duration(%s * time.Second),",p.timeout).push(indent,"}").blank()),v.push(indent,v.var("reqUrl")+" := "+getUrl(e,v)),e.postData)switch(utils_1.normalizeMimeType(e.postData.mimeType)){case"application/x-www-form-urlencoded":v.push(indent,"%s := url.Values{}",v.var("data")),e.postData.params.forEach((function(e){v.push(indent,'%s.Set("%s", "%s")',v.var("data"),e.name,e.value)})),v.push(indent,'%s, %s := http.NewRequest("%s", %s, strings.NewReader(%s.Encode()))',v.var("req"),h,c,v.var("reqUrl"),v.var("data")),e.allHeaders["Content-Length"]="strconv.Itoa(len("+v.var("data")+".Encode()))";break;case"multipart/form-data":v.push(indent,"%s := &bytes.Buffer{}",v.var("data")).push(indent,"writer := multipart.NewWriter(%s)",v.var("data")),e.postData.params.forEach((function(e){if(!e.fileName&&!e.contentType)return v.push(indent,'fw, _ := writer.CreateFormField("%s")',e.name).push(indent,'_, %s = io.Copy(fw, strings.NewReader("%s"))',h,e.value),void m();e.fileName&&(v.push(indent,'fw, %s = writer.CreateFormFile("%s", "%s")',h,e.name,e.fileName),m())})),v.push(indent,"writer.Close()").blank().push(indent,"%s := bytes.NewReader(%s.Bytes())",v.var("payload"),v.var("data")).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',v.var("req"),h,c,v.var("reqUrl"),v.var("payload")),e.allHeaders["Content-Type"]="writer.FormDataContentType()";break;default:e.postData.text&&v.push(indent,"%s := strings.NewReader(%s)",v.var("payload"),JSON.stringify(null===(o=e.postData)||void 0===o?void 0:o.text)).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',v.var("req"),h,c,v.var("reqUrl"),v.var("payload"))}else v.push(indent,'%s, %s := http.NewRequest("%s", %s, nil)',v.var("req"),h,c,v.var("reqUrl"));return m(),e.basicAuth&&v.push(indent,'%s.SetBasicAuth("<username>", "<password>")',v.var("req")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){v.push(indent,'%s.Header.Add("%s", %s)',v.var("req"),t,e.allHeaders[t])})),v.push(indent,"%s, %s := %s.Do(%s)",v.var("res"),h,d,v.var("req")),m(),p.printBody&&(v.blank().push(indent,"defer %s.Body.Close()",v.var("res")).push(indent,"%s, %s := ioutil.ReadAll(%s.Body)",v.var("body"),h,v.var("res")),m()),v.blank().push(indent,"fmt.Println(%s)",v.var("res")),p.printBody&&v.push(indent,"fmt.Println(string(%s))",v.var("body")),p.showBoilerplate&&v.push("}"),v.join()};exports.info={key:"native",title:"NewRequest",link:"http://golang.org/pkg/net/http/#NewRequest",description:"Golang HTTP client request"},exports.default=handler;
//# sourceMappingURL=native.js.map