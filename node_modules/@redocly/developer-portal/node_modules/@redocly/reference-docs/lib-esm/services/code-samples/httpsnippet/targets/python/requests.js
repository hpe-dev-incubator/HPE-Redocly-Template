import{__assign}from"tslib";import{format}from"util";import{CodeBuilder}from"../../helpers/code-builder";import{normalizeMimeType}from"../../../../utils";import{addIndentation,parseUrlIntoOperands}from"../../helpers/code-helpers";import{HTTPSnippet}from"../..";import{Lang,VariableType}from"../../helpers/constants";var printPathVariablesCodeLines=function(e,a){return Object.keys(e).forEach((function(t){var r=e[t]||"YOUR_"+t+"_PARAMETER";a.push(a.var(t,VariableType.PATH)+' = "%s"',r)}))};function getUrl(e,a){var t=e.fullUrl,r=void 0===t?"":t,o=e.pathParameters;return parseUrlIntoOperands(r,void 0===o?{}:o).map((function(e){return"variable"===e.type?a.var(e.name,VariableType.PATH):'"'+e.value+'"'})).join(" + ")}var handler=function(e,a,t){var r,o,s,n=t.target,i=t.client,l=Object.assign({indent:"  "},a),p=new CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,lang:Lang.PYTHON});l.withComments&&addComments(p),l.withImports&&p.push("import requests").blank();var u,d,h=!1,m=e.allHeaders;if(null===(r=e.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length){var c=new HTTPSnippet(null===(o=e.securityOAuth2ExtraCalls)||void 0===o?void 0:o[0]).convert(n,i,__assign(__assign({},l),{withImports:!1,withComments:!1,variablesPrefix:"oauth2_"}));p.push(c),p.blank(),(m=m||{}).Authorization='"Bearer " + oauth2_data["access_token"]',h=!0}(printPathVariablesCodeLines(e.pathParameters,p),p.push(p.var("url").toLowerCase()+" = %s",getUrl(e,p)).blank(),Object.keys(e.queryObj||{}).length)&&(u="query = "+jsObjectToPythonDict(e.queryObj,l.indent),p.push(u).blank());var v,f=normalizeMimeType(null===(s=e.postData)||void 0===s?void 0:s.mimeType);if(e.postData)switch(f){case"application/x-www-form-urlencoded":d=e.postData.paramsObj?""+addIndentation(jsObjectToPythonDict(e.postData.paramsObj,l.indent),{level:0,firstLine:!1}):e.postData.text;break;case"application/json":e.postData.jsonObj&&(d=addIndentation(jsObjectToPythonDict(e.postData.jsonObj,l.indent),{level:0,firstLine:!1}));break;case"multipart/form-data":p.unshift("# multipart/form-data is not supported yet\n");break;default:e.postData.text&&(console.log(e.postData.text),d="'''\n"+addIndentation(e.postData.text.trim(),{level:1,indent:l.indent,firstLine:!0})+"\n'''")}d&&p.push(p.var("payload").toLowerCase()+" = %s",d).blank();var b=Object.keys(m).length,_=function(e,a){return"Authorization"===e&&h?a:'"'+a+'"'};if(1===b)for(v in m)p.push(p.var("headers").toLowerCase()+' = {"'+v+'": '+_(v,m[v])+"}").blank();else if(b>1){var C=1;for(v in p.push(p.var("headers").toLowerCase()+" = {"),m)C++!==b?p.push(1,'"'+v+'": '+_(v,m[v])+","):p.push(1,'"'+v+'": '+_(v,m[v]));p.push(0,"}").blank()}var j=e.method.toLowerCase(),y=format(p.var("response").toLowerCase()+" = requests."+j+"("+p.var("url").toLowerCase());d&&(y+=", "+("application/json"===f?"json":"data")+"="+p.var("payload").toLowerCase());return b>0&&(y+=", headers="+p.var("headers").toLowerCase()),u&&(y+=", params="+p.var("query").toLowerCase()),e.basicAuth&&(y+=", auth=('<username>','<password>')"),y+=")",p.push(y).blank().push(p.var("data").toLowerCase()+" = "+p.var("response").toLowerCase()+".json()").push("print("+p.var("data").toLowerCase()+")"),p.join()};export default handler;function addComments(e){e.push('"""'),e.push("Requires python >= 3"),e.blank(),e.push('Requires module "requests" >= 2.25.1'),e.push("See here for installation details:"),e.push("  https://requests.readthedocs.io/"),e.push('"""'),e.blank()}function jsObjectToPythonDict(e,a){return JSON.stringify(e,(function(e,a){return e&&"boolean"==typeof a?a?"__REDOCLY_<True>__":"__REDOCLY_<False>__":null===a?"__REDOCLY_<None>__":a}),a).replace(/"__REDOCLY_<(\w+)>__"/g,"$1")}
//# sourceMappingURL=requests.js.map