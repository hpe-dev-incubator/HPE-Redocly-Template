import{__assign}from"tslib";import{CodeBuilder}from"../../helpers/code-builder";import{HTTPSnippet}from"../..";import{Lang,VariableType}from"../../helpers/constants";import{parseUrlIntoOperands}from"../../helpers/code-helpers";import{normalizeMimeType}from"../../../../utils";var indent=1;function printPathVariablesCodeLines(e,t){var r=e.pathParameters;Object.keys(r).forEach((function(e){var a=r[e]||"YOUR_"+e+"_PARAMETER";t.push(indent,t.var(e,VariableType.PATH)+' := "%s";',a)}))}function getUrl(e,t){var r=e.fullUrl,a=void 0===r?"":r,n=e.pathParameters;return parseUrlIntoOperands(a,void 0===n?{}:n).map((function(e){return"variable"===e.type?t.var(e.name,VariableType.PATH):'"'+e.value+'"'})).join(" + ")}function hasMimeType(e,t){return void 0===e&&(e={}),normalizeMimeType(e.mimeType)===t}var handler=function(e,t,r){var a,n,s,i,o,p=r.target,d=r.client,l=__assign({showBoilerplate:!0,checkErrors:!1,printBody:!0,timeout:-1,indent:"  "},t),u=null===(a=e.securityOAuth2ExtraCalls)||void 0===a?void 0:a[0],h=l.checkErrors?"err":"_",c=e.method.toUpperCase(),m=new CodeBuilder({indentation:l.indent,variablesPrefix:l.variablesPrefix,capitalize:!0,lang:Lang.GO}),v=function(){l.checkErrors&&m.push(indent,"if err != nil {").push(indent+1,"panic(err)").push(indent,"}")};if(l.showBoilerplate&&(m.push("package main").blank().push("import (").push(indent,'"fmt"'),l.timeout>0&&m.push(indent,'"time"'),u&&m.push(indent,'"encoding/json"'),hasMimeType(e.postData,"multipart/form-data")&&(m.push(indent,'"mime/multipart"'),m.push(indent,'"io"'),m.push(indent,'"os"'),m.push(indent,'"bytes"')),(hasMimeType(e.postData,"application/x-www-form-urlencoded")||hasMimeType(null===(s=null===(n=e.securityOAuth2ExtraCalls)||void 0===n?void 0:n[0])||void 0===s?void 0:s.postData,"application/x-www-form-urlencoded"))&&(m.push(indent,'"net/url"'),m.push(indent,'"strconv"')),((null===(i=e.postData)||void 0===i?void 0:i.text)||u)&&m.push(indent,'"strings"'),m.push(indent,'"net/http"'),l.printBody&&m.push(indent,'"io/ioutil"'),m.push(")").blank().push("func main() {")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){e.allHeaders[t]='"'+e.allHeaders[t]+'"'})),u){var f="oAuth2",y=l.checkErrors?h+" := ":"",w=new HTTPSnippet(u).convert(p,d,__assign(__assign({},l),{variablesPrefix:f,showBoilerplate:!1}));m.push(w).blank().push(indent,"var "+m.var("resBody")+" struct {",f).push(indent+1,"Access_token string").push(indent,"}").push(indent,"%sjson.NewDecoder(%sres.Body).Decode(&%sresBody)",y,f,f).blank(),v(),e.allHeaders.Authorization='"Bearer " + oAuth2resBody.Access_token'}if(printPathVariablesCodeLines(e,m),l.timeout>0&&(d=m.var("client"),m.push(indent,"%s := http.Client{",d).push(indent+1,"Timeout: time.Duration(%s * time.Second),",l.timeout).push(indent,"}").blank()),m.push(indent,m.var("reqUrl")+" := "+getUrl(e,m)),e.postData)switch(normalizeMimeType(e.postData.mimeType)){case"application/x-www-form-urlencoded":m.push(indent,"%s := url.Values{}",m.var("data")),e.postData.params.forEach((function(e){m.push(indent,'%s.Set("%s", "%s")',m.var("data"),e.name,e.value)})),m.push(indent,'%s, %s := http.NewRequest("%s", %s, strings.NewReader(%s.Encode()))',m.var("req"),h,c,m.var("reqUrl"),m.var("data")),e.allHeaders["Content-Length"]="strconv.Itoa(len("+m.var("data")+".Encode()))";break;case"multipart/form-data":m.push(indent,"%s := &bytes.Buffer{}",m.var("data")).push(indent,"writer := multipart.NewWriter(%s)",m.var("data")),e.postData.params.forEach((function(e){if(!e.fileName&&!e.contentType)return m.push(indent,'fw, _ := writer.CreateFormField("%s")',e.name).push(indent,'_, %s = io.Copy(fw, strings.NewReader("%s"))',h,e.value),void v();e.fileName&&(m.push(indent,'fw, %s = writer.CreateFormFile("%s", "%s")',h,e.name,e.fileName),v())})),m.push(indent,"writer.Close()").blank().push(indent,"%s := bytes.NewReader(%s.Bytes())",m.var("payload"),m.var("data")).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',m.var("req"),h,c,m.var("reqUrl"),m.var("payload")),e.allHeaders["Content-Type"]="writer.FormDataContentType()";break;default:e.postData.text&&m.push(indent,"%s := strings.NewReader(%s)",m.var("payload"),JSON.stringify(null===(o=e.postData)||void 0===o?void 0:o.text)).push(indent,'%s, %s := http.NewRequest("%s", %s, %s)',m.var("req"),h,c,m.var("reqUrl"),m.var("payload"))}else m.push(indent,'%s, %s := http.NewRequest("%s", %s, nil)',m.var("req"),h,c,m.var("reqUrl"));return v(),e.basicAuth&&m.push(indent,'%s.SetBasicAuth("<username>", "<password>")',m.var("req")),Object.keys(e.allHeaders).length&&Object.keys(e.allHeaders).forEach((function(t){m.push(indent,'%s.Header.Add("%s", %s)',m.var("req"),t,e.allHeaders[t])})),m.push(indent,"%s, %s := %s.Do(%s)",m.var("res"),h,d,m.var("req")),v(),l.printBody&&(m.blank().push(indent,"defer %s.Body.Close()",m.var("res")).push(indent,"%s, %s := ioutil.ReadAll(%s.Body)",m.var("body"),h,m.var("res")),v()),m.blank().push(indent,"fmt.Println(%s)",m.var("res")),l.printBody&&m.push(indent,"fmt.Println(string(%s))",m.var("body")),l.showBoilerplate&&m.push("}"),m.join()};export var info={key:"native",title:"NewRequest",link:"http://golang.org/pkg/net/http/#NewRequest",description:"Golang HTTP client request"};export default handler;
//# sourceMappingURL=native.js.map