import{__assign}from"tslib";import{CodeBuilder}from"../../helpers/code-builder";import{HTTPSnippet}from"../..";import{normalizeMimeType}from"../../../../utils";import{addIndentation,parseUrlIntoOperands}from"../../helpers/code-helpers";import{Lang,VariableType}from"../../helpers/constants";var printPathVariablesCodeLines=function(a,t){return Object.keys(a).forEach((function(e){var r=a[e]||"YOUR_"+e+"_PARAMETER";t.push(2,"var "+t.var(e,VariableType.PATH)+' = "%s";',r)}))};function getUrl(a,t){var e=a.pathname,r=void 0===e?"":e,s=a.pathParameters;return parseUrlIntoOperands(r,void 0===s?{}:s).map((function(a){return"variable"===a.type?t.var(a.name,VariableType.PATH):'"'+a.value+'"'})).join(" + ")}var URL_ENCODED="application/x-www-form-urlencoded",hasQueryParams=function(a){return!(!a.uriObj.query||!Object.keys(a.uriObj.query).length)},getBody=function(a){return a.postData&&a.postData.mimeType===URL_ENCODED?"HttpRequest.BodyPublishers.ofString(form)":a.postData?"HttpRequest.BodyPublishers.ofString(payload)":["POST","PUT","PATCH"].includes(a.method.toUpperCase())?'HttpRequest.BodyPublishers.ofString("some body text")':""},handler=function(a,t,e){var r,s,n,o=e.target,i=e.client,p=Object.assign({indent:"  ",withWrapper:!0},t),l=new CodeBuilder({indentation:p.indent,variablesPrefix:p.variablesPrefix,capitalize:!0,lang:Lang.JAVA}),u=!1;if(p.withComments&&addComments(l,a),p.withImports&&addImports(l,a),p.withWrapper&&(l.push("public class App {"),l.push(1,"public static void main(String[] args) throws Exception {"),l.push(2,"var httpClient = HttpClient.newBuilder().build();"),l.blank()),null===(r=a.securityOAuth2ExtraCalls)||void 0===r?void 0:r.length){var h=new HTTPSnippet(null===(s=a.securityOAuth2ExtraCalls)||void 0===s?void 0:s[0]).convert(o,i,__assign(__assign({},p),{withImports:!1,withWrapper:!1,withComments:!1,variablesPrefix:"oauth2"}));l.push(h),l.blank(),l.push(2,"var oauth2Response = httpClient.send(oauth2Request, HttpResponse.BodyHandlers.ofString());"),l.push(2,'var accessToken = new JSONObject(oauth2Response.body()).getString("access_token");'),l.blank()}if(a.postData)switch(normalizeMimeType(a.postData.mimeType)){case URL_ENCODED:a.postData.params&&(l.push(2,"HashMap<String, String> params = new HashMap<>();"),a.postData.params.forEach((function(a){l.push(2,'params.put("%s", "%s");',a.name,a.value)})),l.blank(),l.push(2,"var form = params.keySet().stream()"),l.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),l.push(3,'.collect(Collectors.joining("&"));'),l.blank());break;case"application/json":a.postData.jsonObj&&(l.push(2,'var payload = String.join("\\n"\n      '+addIndentation(JSON.stringify(a.postData.jsonObj,null,1).replace(/"/g,'\\"').replace(/^/gm,', "').replace(/$/gm,'"'),{level:3,indent:p.indent,firstLine:!1})),l.push(2,");"),l.blank());break;case"application/xml":a.postData.text&&(l.push(2,'var payload = String.join("\\n"'),a.postData.text.trim().split("\n").forEach((function(a){var t=a.replace(/"/g,'\\"');l.push(3,', "'+t+'"')})),l.push(2,");"),l.blank());break;case"multipart/form-data":u=!0,l.unshift("# multipart/form-data is not supported yet\n")}if(hasQueryParams(a)){l.push(2,"HashMap<String, String> params = new HashMap<>();");for(var d=0,m=Object.entries(a.uriObj.query);d<m.length;d++){var c=m[d],v=c[0],y=c[1];l.push(2,'params.put("%s", "%s");',v,y)}l.blank(),l.push(2,"var query = params.keySet().stream()"),l.push(3,'.map(key -> key + "=" + URLEncoder.encode(params.get(key), StandardCharsets.UTF_8))'),l.push(3,'.collect(Collectors.joining("&"));'),l.blank()}l.push(2,"var "+l.var("host")+' = "%s";',a.uriObj.protocol+"//"+a.uriObj.host),printPathVariablesCodeLines(a.pathParameters,l),l.push(2,"var "+l.var("pathname")+" = %s;",getUrl({pathname:a.uriObj.pathname,pathParameters:a.pathParameters},l)),l.push(2,"var "+l.var("request")+" = HttpRequest.newBuilder()"),"PATCH"===a.method.toUpperCase()?l.push(3,'.method("PATCH", %s)',getBody(a)):l.push(3,".%s(%s)",a.method.toUpperCase(),getBody(a)),l.push(3,".uri(URI.create("+l.var("host")+" + "+l.var("pathname")+" %s))",hasQueryParams(a)?"+ '?' + query":""),(null===(n=a.securityOAuth2ExtraCalls)||void 0===n?void 0:n.length)&&(a.allHeaders.Authorization='"Bearer " + accessToken');var g=Object.keys(a.allHeaders);return g.length&&g.forEach((function(t){var e;l.push(3,'.header("%s", %s)',t,"Authorization"===t&&(null===(e=a.securityOAuth2ExtraCalls)||void 0===e?void 0:e.length)?a.allHeaders[t]:'"'+a.allHeaders[t]+'"')})),a.basicAuth&&l.push(3,'.header("Authorization", "Basic " + Base64.getEncoder().encodeToString(("<username>:<password>").getBytes()))'),l.push(3,".build();"),p.withWrapper&&(l.blank(),l.push(2,"var response = httpClient.send(request, HttpResponse.BodyHandlers.ofString());"),l.blank(),l.push(2,"System.out.println(response.body());"),l.push(1,"}"),l.push("}")),u&&l.clean(),l.join()};export var info={key:"httpclient",title:"HttpClient",link:"https://docs.oracle.com/en/java/javase/11/docs/api/java.net.http/java/net/http/HttpClient.html",description:"HttpClient (Java SE 11 & JDK 11 )"};export default handler;function addComments(a,t){var e;a.push("/**"),a.push(" * Requires JDK >= 11"),(null===(e=t.securityOAuth2ExtraCalls)||void 0===e?void 0:e.length)&&(a.push(" *"),a.push(' * Requires package "org.json" >= 20201115'),a.push(" * See here for installation details:"),a.push(" *  https://search.maven.org/artifact/org.json/json")),a.push(" */"),a.blank()}function addImports(a,t){var e,r,s,n;a.push("import java.net.*;"),a.push("import java.net.http.*;"),a.push("import java.util.*;"),(normalizeMimeType(null===(e=t.postData)||void 0===e?void 0:e.mimeType)===URL_ENCODED&&(null===(r=t.postData)||void 0===r?void 0:r.params)||(null===(s=t.securityOAuth2ExtraCalls)||void 0===s?void 0:s.length)||hasQueryParams(t))&&(a.push("import java.nio.charset.StandardCharsets;"),a.push("import java.util.stream.Collectors;")),(null===(n=t.securityOAuth2ExtraCalls)||void 0===n?void 0:n.length)&&a.push("import org.json.JSONObject;"),a.blank()}
//# sourceMappingURL=httpclient.js.map