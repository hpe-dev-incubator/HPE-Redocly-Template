import*as React from"react";import Popup from"reactjs-popup";import{useParams}from"@reach/router";import{Flex,Typography}from"../../ui";import styled from"styled-components";import{IconButton,MenuItemButton,TableCell}from"./common-elements/styled.elements";import CopyButton from"./common-elements/CopyButton";import EditApiKey from"./EditApiKey";import{APIClientContext}from"../services/APIClientProvider";import{getReadableDate}from"../services/helpers";import{useMutation,useQueryClient}from"react-query";import{QUERY_KEY_APP}from"../services/config";import ApiKeyProducts from"./ApiKeyProducts";import{appTheme}from"../../appTheme";import{PopupMenuUl}from"./popup-menu";export default function ApiKeyItem(a){const{apiClient:b}=React.useContext(APIClientContext),c=useQueryClient(),{credential:d,attributes:e}=a,f=useParams(),[g,h]=React.useState(!1),[i,j]=React.useState(!1),[k,l]=React.useState(!1),{isLoading:m,error:n,mutate:o}=useMutation(()=>b.deleteDeveloperAppKey(f.appName,d.consumerKey),{onMutate:async()=>{await c.cancelQueries(QUERY_KEY_APP);const a=c.getQueryData(QUERY_KEY_APP),b=a?.credentials.filter(a=>a.consumerKey!==d.consumerKey);return c.setQueryData(QUERY_KEY_APP,a=>({...a,credentials:b})),a},onSettled:()=>{c.invalidateQueries(QUERY_KEY_APP)}}),p=getReadableDate(d.issuedAt),q=0<+d.expiresAt?getReadableDate(d.expiresAt):"Never",r=()=>{j(!0),l(!1)};return React.createElement(React.Fragment,null,React.createElement("tr",{style:{verticalAlign:"top"}},React.createElement(TableCell,{style:{gridArea:"key"}},React.createElement(Flex,{justifyContent:{xs:"space-between",medium:"flex-start"}},React.createElement(ApiKeyProducts,{credentialApiProducts:d.apiProducts}),React.createElement(TruncatedText,{title:d.consumerKey},d.consumerKey),React.createElement(CopyButton,{value:d.consumerKey}))),React.createElement(TableCell,{style:{gridArea:"secret"}},React.createElement(Flex,{justifyContent:{xs:"space-between",medium:"start"}},React.createElement(TruncatedText,{title:g?d.consumerSecret:""},g?d.consumerSecret:d.consumerSecret.replace(/./g,"*")),React.createElement("div",null,React.createElement(IconButton,{onClick:()=>h(!g)},g?React.createElement(InvisibleIcon,null):React.createElement(VisibleIcon,null)),React.createElement(CopyButton,{value:d.consumerSecret})))),React.createElement(TableCell,{style:{gridArea:"created"}},React.createElement(Date,null,p)),React.createElement(TableCell,{style:{gridArea:"expires"}},React.createElement(Date,null,q)),React.createElement(TableCell,{align:"right",style:{gridArea:"action"}},React.createElement(Popup,{trigger:React.createElement(IconButton,null,React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 384",width:"15px",fill:appTheme.colors.text.primary},React.createElement("circle",{cx:"192",cy:"42.667",r:"42.667"}),React.createElement("circle",{cx:"192",cy:"192",r:"42.667"}),React.createElement("circle",{cx:"192",cy:"341.333",r:"42.667"}))),position:"bottom center",on:"click",closeOnDocumentClick:!0,arrow:!1,open:k,onOpen:()=>l(!0),onClose:()=>l(!1)},React.createElement(PopupMenuUl,null,React.createElement("li",null,React.createElement(MenuItemButton,{onClick:r},"Edit")),React.createElement("li",null,React.createElement(MenuItemButton,{onClick:()=>o(),disabled:m},"Delete key")))))),i&&React.createElement(EditApiKey,{credential:d,attributes:e,open:i,onClose:()=>j(!1),onOpen:r}),n&&React.createElement("tr",null,React.createElement(TableCell,null,React.createElement(Typography,{mt:"0",mb:"0",color:appTheme.colors.error.main},n.message))))}const InvisibleIcon=()=>React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 469.44 469.44",width:"18px",height:"18px"},React.createElement("path",{d:"M231.147 160.373l67.2 67.2.32-3.52c0-35.307-28.693-64-64-64l-3.52.32z"}),React.createElement("path",{d:"M234.667 117.387c58.88 0 106.667 47.787 106.667 106.667 0 13.76-2.773 26.88-7.573 38.933l62.4 62.4c32.213-26.88 57.6-61.653 73.28-101.333-37.013-93.653-128-160-234.773-160-29.867 0-58.453 5.333-85.013 14.933l46.08 45.973c12.052-4.693 25.172-7.573 38.932-7.573zM21.333 59.253l48.64 48.64 9.707 9.707C44.48 145.12 16.64 181.707 0 224.053c36.907 93.653 128 160 234.667 160 33.067 0 64.64-6.4 93.547-18.027l9.067 9.067 62.187 62.293 27.2-27.093L48.533 32.053l-27.2 27.2zM139.307 177.12l32.96 32.96c-.96 4.587-1.6 9.173-1.6 13.973 0 35.307 28.693 64 64 64 4.8 0 9.387-.64 13.867-1.6l32.96 32.96c-14.187 7.04-29.973 11.307-46.827 11.307-58.88 0-106.667-47.787-106.667-106.667 0-16.853 4.267-32.64 11.307-46.933z"})),VisibleIcon=()=>React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 469.333 469.333",width:"18px",height:"18px"},React.createElement("path",{d:"M234.667 170.667c-35.307 0-64 28.693-64 64s28.693 64 64 64 64-28.693 64-64-28.694-64-64-64z"}),React.createElement("path",{d:"M234.667 74.667C128 74.667 36.907 141.013 0 234.667c36.907 93.653 128 160 234.667 160 106.773 0 197.76-66.347 234.667-160-36.907-93.654-127.894-160-234.667-160zm0 266.666c-58.88 0-106.667-47.787-106.667-106.667S175.787 128 234.667 128s106.667 47.787 106.667 106.667-47.787 106.666-106.667 106.666z"})),Date=styled.span`
  color: ${({theme:a})=>a.colors.text.secondary};
`,TruncatedText=styled.span`
  display: inline-block;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  width: 15ch;
`;