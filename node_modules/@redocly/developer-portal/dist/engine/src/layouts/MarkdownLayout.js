import{format}from"timeago.js";import*as React from"react";import{withTheme,ThemeContext}from"../styled-components";import{StyledContent}from"../components/StyledContent/StyledContent";import{ProStore}from"@redocly/reference-docs";import TableOfContent from"../components/TableOfContent/TableOfContent";import UserMarkdownLayout from"../components/UserComponents/layouts/Markdown";import{sanitizeDefinitionId}from"../../utils";const LS_SNIPPETS_LANG="redocly_snippetsLang";export const RedocStoresContext=React.createContext({});function getStoreStateById(a,b){const c=(a["__oasDef_"+sanitizeDefinitionId(b)]||{}).redocStoreStr,d=c&&JSON.parse(c)||void 0;return d}function constructStoreFromPageData(a,b,c){const d=getStoreStateById(a,c);return d?(d.options=d.options||{},d.options.disableSearch=!0,d.options.showNextButton=!1,d.options.disableSidebar=!0,d.options.disableDeepLinks=!0,d.options.theme=b,d.options.showConsole=d.options.showConsole||!0,ProStore.fromJS(d)):null}class GetStoreInner extends React.Component{render(){return React.createElement(RedocStoresContext.Consumer,null,a=>{const b=constructStoreFromPageData(a,this.props.theme,this.props.definitionId);return b?this.props.children(b):React.createElement("pre",{style:{color:"red"}},"Incorrect definitionId: \"",this.props.definitionId,"\"")})}}export const GetStore=withTheme(GetStoreInner);export function useOasDefinitionStore(a){const b=React.useContext(ThemeContext),c=React.useContext(RedocStoresContext);return constructStoreFromPageData(c,b,a)}export function useOasDefinition(a){const b=React.useContext(RedocStoresContext);return getStoreStateById(b,a)?.definition?.data||null}export default function MarkdownLayout(a){const[b,c]=React.useState(null),d=React.useCallback(a=>{c(a)},[]);React.useEffect(()=>{if(!b)return()=>void 0;if(b?.addEventListener("click",onSnippetTabClick),a.location.hash)switchSnippetsLang(a.location.hash.substring(1));else{const a=window.localStorage&&window.localStorage.getItem(LS_SNIPPETS_LANG);a&&switchSnippetsLang(a)}return()=>b?.removeEventListener("click",onSnippetTabClick)},[b]);const{html:e,data:f,location:g,pageContext:h}=a,i=f.contentItem&&f.contentItem.data.lastModified,j=isTocEnabled(f),k=f.contentItem?.data.tocMaxDepth||f.siteConfig?.tocMaxDepth,l=f.markdownRemark&&f.markdownRemark.headings,m={};for(let b in f)b.startsWith("__oasDef_")&&(m[b]=f[b]);const n=null==e?React.createElement(StyledContent,{ref:d},a.children):React.createElement(StyledContent,{ref:d,dangerouslySetInnerHTML:{__html:e||""}}),o=h.data||{},p=h.pageId||"";return React.createElement(RedocStoresContext.Provider,{value:m},React.createElement(UserMarkdownLayout,{location:g,headings:l,contentWrapper:b,Toc:()=>j?React.createElement(TableOfContent,{headings:l,tocMaxDepth:k,contentWrapper:b}):null,withToc:j,lastModified:!disableLastModified(f)&&i||void 0,lastModifiedAgo:i&&!disableLastModified(f)?format(i):void 0,frontmatter:o,pageId:p},n))}function onSnippetTabClick(a){if(a.target.classList.contains("tab-header")&&a.target.parentElement.classList.contains("snippets-tabs-headers")){const b=a.target.dataset.snippetId||a.target.dataset.lang;history.pushState(null,"","#"+b),switchSnippetsLang(b)}}function switchSnippetsLang(a){function b(a,b){if(a)for(const c of a)c.dataset.snippetId===b?c.classList.add("active"):c.classList.remove("active")}const c=document.querySelectorAll(`[data-snippet-id="${a}"]`);window.localStorage&&window.localStorage.setItem(LS_SNIPPETS_LANG,a);for(const d of c)b(d.parentElement?.children,a)}export function isTocEnabled(a){if(!a)return!1;const b=a.markdownRemark&&a.markdownRemark.headings,c=b&&b.some(a=>4>=a.depth),d=1===b?.length&&1===b[0]?.depth;if(!c||d)return!1;const e=a.contentItem&&a.contentItem.data.enableToc,f=a.siteConfig&&a.siteConfig.enableToc;return!1!==e&&(e||f)}export function disableLastModified(a){if(!a)return!1;const b=a.contentItem&&a.contentItem.data.disableLastModified,c=a.siteConfig&&a.siteConfig.disableLastModified;return!1!==b&&(b||c)}